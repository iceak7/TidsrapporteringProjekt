# TidsrapporteringProjekt
Skolprojekt

När det kommer till databasen valde jag att skapa totalt fyra tabeller. Eftersom en anställd skulle kunna jobba på flera projekt och ett projekt skulle kunna jobbas på av flera anställda så skapade jag en many to many relation mellan projekt och anställd-tabellerna.  Därför behövde jag skapa en kopplingstabell mellan anställd och projekt.  En anställd skulle också kunna ha flera timrapporter men en timrapport tyckte jag bara skulle tillhöra en anställd så där blev det en one to many relation.

Databasen skapade jag genom entity-framework och en model-first approach. Jag tycker det är enklare och smidigare att börja med modellerna först och skapa dem i solutionen där jag sedan kommer jobba med resten av projektet. Modellerna lade jag i ett classlibrary och refererade sen till ifrån API-projektet.

Applikationen skapade jag genom repository pattern för att man senare enklare skulle kunna använda en annan datakälla. Jag valde att skapa ett generiskt ”huvud”-interface med CRUD-metoderna som jag skulle behöva i alla repositoryna. Sedan skapade jag de specifika interfacen för de repositoryna som skulle ha någon specifik funktion som t.ex. att hämta en anställds jobbtimmar för en specifik vecka. I dessa interface ärvde jag ifrån ”huvud”-interfacet för att få med alla metoder och slippa skriva de flera gånger.

När det kommer till att skapa själva repositoryna och controllerna var det ganska straight forward när det gäller det mesta. CRUD-metoderna och controllerna var väldigt lika för employee, project och timereport. 

Funktionen för att hämta ut en specifik anställd och dennas tidsrapporter löste jag genom att med NewtonsoftJson och Include-metoden länka in tidrapporterna till den anställda i metoden GetSingle i Employee-repot. Detta var det enklaste och smidigaste sättet tyckte jag. 

För att få ut alla anställda som jobbat med ett specifikt projekt skapade jag metoden GetEmployeesWorkingOnProject i Project-repot och den tog projekt-id:et. Sedan hämtade jag alla employees, inkluderade datan från kopplingstabbellen ProjectEmployee med include, och filtrerade sedan ut de anställda som jobbat på projektet med det id:et. Sedan skickade jag de anställda som blev resultatet till controllern. Lösningen blev väldigt kort och smidig. Jag tyckte också det var logiskt att den funktionen låg under Project-controllern och repot då jag tycker den informationen tillhör projekt. I jsonen som sedan visas döljer jag ProjectEmployee objekten med ”JsonIgnore” för att det ska se snyggare ut.

För att få ut hur många timmar en anställd jobbat en specifik vecka skapade jag en metod i TimeReport-repot som jag döpte till WorkedHoursPerWeekandEmployee. Den metoden lät jag ta employeeId och weekNr som parametrar. Det första jag gjorde vara att filtrera ut alla tidrapporter för den anställda med det id:et. Sedan använde jag mig utav metoden GetWeekOfYear som tillhör Calendar-klassen som ligger under System.Globalization. Med den kunde jag enkelt filtrera ut de rapporterna för den veckan som timmarna skulle hämtas ifrån. Sedan hade jag skapat en till klass som hette WorkedHours som metoden sedan returnerar. Den klassen innehåller veckonumret, antal timmar jobbade och id:et på den anställda. De tidrapporterna som är filtrerade loopas sen igenom och stoppas in i det här WorkedHours-objektet och sedan returnerar metoden objektet. I controllern som ligger under employee och har endpointen employee/{id}/week/{weekNr} kallas sen den här metoden och skickar ut objektet som json om requesten var rätt. Jag tycker den här lösningen blev bra och att skapa klassen WorkedHours gjorde att jag enkelt och snyggt kunde returnera den datan som jag tyckte var relevant. 

